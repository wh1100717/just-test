/*! LocalDB - v0.0.1 - 2014-10-21
* Copyright (c) 2014 Eric Wang; Licensed MIT */
require.config({baseUrl:"./"}),define("lib/binary-parser",function(a,b,c){function d(a,b){return this instanceof d?(this.bigEndian=a,void(this.allowExceptions=b)):new d(a,b)}function e(a,b){this.bigEndian=a||0,this.buffer=[],this.setBuffer(b)}for(var f=(String.fromCharCode,[]),g=0;64>g;g++)f[g]=Math.pow(2,g);d.warn=function(a){if(this.allowExceptions)throw new Error(a);return 1},d.decodeInt=function(a,b,c,d){var e=new this.Buffer(this.bigEndian||d,a),g=e.readBits(0,b),h=f[b];return c&&g>=h/2?g-h:g},d.encodeInt=function(a,b,c,d){var e=f[b];(a>=e||-(e/2)>a)&&(this.warn("encodeInt::overflow"),a=0),0>a&&(a+=e);for(var g=[];a;g[g.length]=String.fromCharCode(a%256),a=Math.floor(a/256));for(b=-(-b>>3)-g.length;b--;g[g.length]="\x00");return(this.bigEndian||d?g.reverse():g).join("")},d.fromByte=function(a){return this.encodeInt(a,8,!1)},d.fromShort=function(a){return this.encodeInt(a,16,!0)},e.prototype.setBuffer=function(a){var b,c,d;if(a){for(c=b=a.length,d=this.buffer=new Array(b);c;d[b-c]=a.charCodeAt(--c));this.bigEndian&&d.reverse()}},e.prototype.hasNeededBits=function(a){return this.buffer.length>=-(-a>>3)},e.prototype.checkBuffer=function(a){if(!this.hasNeededBits(a))throw new Error("checkBuffer::missing bytes")},e.prototype.readBits=function(a,b){function c(a,b){for(;b--;a=1073741824==(1073741824&(a%=2147483648))?2*a:2*(a-1073741824)+2147483647+1);return a}if(0>a||0>=b)return 0;this.checkBuffer(a+b);for(var d,e=a%8,f=this.buffer.length-(a>>3)-1,g=this.buffer.length+(-(a+b)>>3),h=f-g,i=(this.buffer[f]>>e&(1<<(h?8-e:b))-1)+(h&&(d=(a+b)%8)?(this.buffer[g++]&(1<<d)-1)<<(h--<<3)-e:0);h;i+=c(this.buffer[g++],(h--<<3)-e));return i},d.Buffer=e,c.exports=d}),define("lib/bson",function(a,b,c){var d,e,f,g,h,i;return d=a("lib/binary-parser"),h=function(){var a,b;for(b=[],i=a=0;256>a;i=++a)b.push((15>=i?"0":"")+i.toString(16));return b}(),e=parseInt(16777215*Math.random(),10),g=/^[0-9a-fA-F]{24}$/,f=function(a){if(this._bsontype="ObjectID",null!=a&&12!==a.length&&24!==a.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(null==a)return this.id=this.generate();if(null!=a&&12===a.length)return this.id=a;if(g.test(a))return f.createFromHexString(a);throw new Error("Value passed in is not a valid 24 character hex string")},f.prototype.generate=function(){var a,b,c,f,g;return g=parseInt(Date.now()/1e3,10),f=d.encodeInt(g,32,!0,!0),b=d.encodeInt(e,24,!1),c=d.fromShort("undefined"==typeof process?Math.floor(1e5*Math.random()):process.pid),a=d.encodeInt(this.get_inc(),24,!1,!0),f+b+c+a},f.prototype.toHexString=function(){var a,b,c;for(a="",i=b=0,c=this.id.length;c>=0?c>b:b>c;i=c>=0?++b:--b)a+=h[this.id.charCodeAt(i)];return a},f.prototype.toString=function(){return this.toHexString()},f.prototype.inspect=f.prototype.toString,f.prototype.getTime=function(){return 1e3*Math.floor(d.decodeInt(this.id.substring(0,4),32,!0,!0))},f.prototype.getTimestamp=function(){var a;return a=new Date,a.setTime(this.getTime()),a},f.prototype.get_inc=function(){return f.index=(f.index+1)%16777215},f.index=parseInt(16777215*Math.random(),10),f.createFromHexString=function(a){var b,c;for(b="",i=c=0;24>c;i=++c)i%2===0&&(b+=d.fromByte(parseInt(a.substr(i,2),16)));return new f(b,a)},c.exports=f}),define("lib/collection",function(a,b,c){var d,e,f;return f=a("lib/utils"),e=a("lib/operation"),d=function(){function a(a,b){if(void 0===a)throw new Error("collectionName should be specified.");this.name=""+b.name+"_"+a,this.ls=b.ls,this.deserialize()}return a.prototype.deserialize=function(){return this.data=f.parse(this.ls.getItem(this.name))},a.prototype.serialize=function(){var a,b;try{this.ls.setItem(this.name,f.stringify(this.data))}catch(c){for(a=c,b=!0;b;)try{this.data.splice(0,1),this.ls.setItem(this.name,f.stringify(this.data)),b=!1}catch(c){}}},a.prototype.drop=function(){return this.ls.removeItem(this.name),!0},a.prototype.insert=function(a,b){return null==b&&(b={}),this.deserialize(),this.data=e.insert(this.data,a,b),this.serialize()},a.prototype.update=function(a,b){return null==b&&(b={}),this.deserialize(),this.data=e.update(this.data,a,b),this.serialize()},a.prototype.remove=function(a){return null==a&&(a={}),this.deserialize(),this.data=e.remove(this.data,a),this.serialize()},a.prototype.find=function(a){return null==a&&(a={}),this.deserialize(),e.find(this.data,a)},a.prototype.findOne=function(a){var b;return null==a&&(a={}),a.limit=1,b=e.find(this.data,a)[0],null!=b?b:{}},a}(),c.exports=d}),define("lib/engine",function(a,b,c){var d,e,f;return e=a("lib/support"),d=function(){function a(a){if(this.type=2===a?2:1,!e.sessionstorage()){if(1===a)throw new Error("sessionStorage is not supported!");if(e.userdata())throw new Error("no browser storage engine is supported in your browser!");this.type=2}2===this.type&&e.localstorage()&&(this.userdata=new f)}return a.prototype.key=function(a){return 1===this.type?sessionStorage.key(a):e.localstorage()?localStorage.key(a):this.userdata.key(a)},a.prototype.size=function(){return 1===this.type?sessionStorage.length:e.localstorage()?localStorage.length:this.userdata.size()},a.prototype.setItem=function(a,b){return 1===this.type?sessionStorage.setItem(a,b):e.localstorage()?localStorage.setItem(a,b):this.userdata.setItem(a,b)},a.prototype.getItem=function(a){return 1===this.type?sessionStorage.getItem(a):e.localstorage()?localStorage.getItem(a):this.userdata.getItem(a,val)},a.prototype.removeItem=function(a){return 1===this.type?sessionStorage.removeItem(a):e.localstorage()?localStorage.removeItem(a):this.userdata.removeItem(a,val)},a.prototype.usage=function(){var a,b,c;if(a="",1===this.tyep)for(b in sessionStorage)c=sessionStorage[b],a+=c;else if(e.localstorage())for(b in localStorage)c=localStorage[b],a+=c;else console.log("todo");return a.length/512},a}(),f=function(){function a(){var a,b;try{b=new ActiveXObject("htmlfile"),b.open(),b.write('<script>document.w=window</script><iframe src="/favicon.ico"></iframe>'),b.close(),this.storageOwner=b.w.frames[0].document,this.storage=this.storageOwner.createElement("div")}catch(c){a=c,this.storage=document.createElement("div"),this.storageOwner=document.body}}return a.prototype.localStorageName="localStorage",a.prototype.forbiddenCharsRegex=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),a.prototype.ieKeyFix=function(a){return a.replace(/^d/,"___$&").replace(this.forbiddenCharsRegex,"___")},a.prototype.setItem=function(a,b){return a=this.ieKeyFix(a),this.storageOwner.appendChild(this.storage),this.storage.addBehavior("#default#userData"),this.storage.load(this.localStorageName),this.storage.setAttribute(a,b),this.storage.save(this.localStorageName),!0},a.prototype.getItem=function(a){return a=this.ieKeyFix(a),this.storageOwner.appendChild(this.storage),this.storage.addBehavior("#default#userData"),this.storage.load(this.localStorageName),this.storage.getAttribute(a)},a.prototype.removeItem=function(a){return a=this.ieKeyFix(a),this.storageOwner.appendChild(this.storage),this.storage.addBehavior("#default#userData"),this.storage.load(this.localStorageName),this.storage.removeAttribute(a),this.storage.save(this.localStorageName)},a.prototype.size=function(){return this.storage.XMLDocument.documentElement.attributes.length},a.prototype.key=function(a){return this.storage.XMLDocument.documentElement.attributes[a]},a}(),c.exports=d}),define("lib/iframe",function(){var a;return a=function(){function a(a){this.origin=a}return a.prototype.create=function(){null==document.getElementById(this.origin)&&(this.ifrm=document.createElement("IFRAME"),this.ifrm.setAttribute("src",this.origin),this.ifrm.setAttribute("id",this.origin),this.ifrm.style.width="1px",this.ifrm.style.height="1px",this.ifrm.style.display="none",document.body.appendChild(this.ifrm))},a.prototype.remove=function(){return this.ifrm.parentElement.removeChild(this.ifrm)},a}()}),define("lib/operation",function(a,b,c){var d,e,f,g,h;return h=a("lib/where"),g=a("lib/utils"),e=a("lib/projection"),d={},d.insert=function(a,b){var c,d,e;if(g.isArray(b))for(d=0,e=b.length;e>d;d++)c=b[d],g.isObject(c)&&(null==c._id&&(c._id=g.createObjectId()),a.push(c));else g.isObject(b)&&(null==b._id&&(b._id=g.createObjectId()),a.push(b));return a},d.update=function(a,b,c){var d,e,g,h,i;i=c.where||{},e=null!=c.multi?c.multi:!0,g=null!=c.upsert?c.upsert:!1;for(d in b)h=b[d],a=f.generate(a,d,h,i,e,g);return a},d.remove=function(a,b){var c,d,e,f,g,i,j;for(g=b.where||{},e=null!=b.multi?b.multi:!0,f=[],d=!1,i=0,j=a.length;j>i;i++)c=a[i],d?f.push(c):h(c,g)?e||(d=!0):f.push(c);return f},d.find=function(a,b){var c,d,f,g,i,j,k;for(i=b.where||{},f=b.projection||{},d=b.limit||-1,g=[],j=0,k=a.length;k>j;j++)if(c=a[j],h(c,i)){if(0===d)break;d-=1,g.push(c)}return e.generate(g,f)},f={isKeyReserved:function(a){return"$inc"===a||"$set"===a||"$mul"===a||"$rename"===a||"$unset"===a||"$max"===a||"$min"===a},generate:function(a,b,c,d,e,g){var i,j,k,l,m,n,o;if(!f.isKeyReserved(b))return a;for(l in c)for(m=c[l],n=0,o=a.length;o>n;n++)if(i=a[n],h(i,d)){for(k=!1;l.indexOf(".")>0;){if(j=l.split(".")[0],i=i[j],null==i&&!g){k=!0;break}g&&(i=i||{}),l=l.substr(l.indexOf(".")+1)}if(!k){switch(b){case"$inc":(null!=i[l]||g)&&(i[l]+=m);break;case"$set":(null!=i[l]||g)&&(i[l]=m);break;case"$mul":(null!=i[l]||g)&&(i[l]*=m);break;case"$rename":i[m]=i[l],delete i[l];break;case"$unset":delete i[l];break;case"$min":(null!=i[l]||g)&&(i[l]=Math.min(i[l],m));break;case"$max":(null!=i[l]||g)&&(i[l]=Math.max(i[l],m))}if(!e)break}}return a}},c.exports=d}),define("lib/projection",function(a,b,c){var d,e,f;return e=a("lib/utils"),d={},d.generate=function(a,b){var c,d,g,h,i;if("{}"===JSON.stringify(b))return a;for(g=[],h=0,i=a.length;i>h;h++)c=a[h],d=f(c,b),e.isEqual(d,{})||g.push(d);return g},f=function(a,b){var c,d,g,h,i,j,k,l,m,n,o,p;k={},h=!0;for(i in b)if(n=b[i],"_id"!==i||-1!==n)if(-1!==i.indexOf(".$")){if(i=i.split(".")[0],!e.isArray(a[i])||0===a[i].length)continue;k[i]=[a[i][0]]}else{if(0===i.indexOf("$elemMatch")){if(!e.isArray(a)||0===a.length)return[];for(j=[],o=0,p=a.length;p>o;o++){g=a[o],c=!0;for(l in n)m=n[l],e.isObject(m)||g[l]!==m&&(c=!1);if(c){j.push(g);break}}return e.isEqual(j,[])?[]:j}e.isObject(n)?(d=f(a[i],n),e.isEqual(d,[])||(k[i]=d)):1===n&&(k[i]=a[i])}else h=!1;return h&&!e.isEqual(k,{})&&(k._id=a._id),k},c.exports=d}),define("lib/support",function(a,b,c){var d,e;return e="lST$*@?",d={},d.localstorage=function(){var a;try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(b){return a=b,!1}},d.sessionstorage=function(){var a;try{return sessionStorage.setItem(e,e),sessionStorage.removeItem(e),!0}catch(b){return a=b,!1}},d.postmessage=function(){return!!postMessage},d.websqldatabase=function(){return!!openDatabase},d.indexedDB=function(){return!!(indexedDB||webkitIndexedDB||mozIndexedDB||OIndexedDB||msIndexedDB)},d.applicationcache=function(){return!!applicationCache},d.userdata=function(){return!!document.documentElement.addBehavior},c.exports=d}),define("lib/utils",function(require,exports,module){var ObjectID,Utils,eq,toString,_isType;return ObjectID=require("lib/bson"),Utils={},toString=Object.prototype.toString,eq=function(a,b,c,d){var e,f,g,h,i,j,k,l,m;if(a===b)return 0!==a||1/a===1/b;if(null===a&&void 0===b)return!1;if(void 0===a&&null===b)return!1;if(h=toString.call(a),h!==toString.call(b))return!1;switch(h){case"[object RegExp]":return""+a==""+b;case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":return+a===+b;case"[object Boolean]":return+a===+b}if(f="[object Array]"===h,!f){if("object"!=typeof a||"object"!=typeof b)return!1;if(e=a.constructor,g=b.constructor,e!==g&&!(Utils.isFunction(e)&&e instanceof e&&Utils.isFunction(g)&&g instanceof g)&&"constructor"in a&&"constructor"in b)return!1}for(k=c.length;k--;)if(c[k]===a)return d[k]===b;if(c.push(a),d.push(b),f){if(m=a.length,l=m===b.length)for(;m--&&(l=eq(a[m],b[m],c,d)););}else if(j=Utils.keys(a),m=j.length,l=Utils.keys(b).length===m)for(;m--&&(i=j[m],l=Utils.has(b,i)&&eq(a[i],b[i],c,d)););return c.pop(),d.pop(),l},_isType=function(a){return function(b){return toString.call(b).toLowerCase()===("[object "+a+"]").toLowerCase()}},Utils.isType=function(a,b){return _isType(b)(a)},Utils.isObject=_isType("object"),Utils.isString=_isType("string"),Utils.isNumber=_isType("number"),Utils.isArray=_isType("array"),Utils.isFunction=_isType("function"),Utils.isRegex=_isType("regexp"),Utils.keys=function(a){return Utils.isObject(a)?Object.keys?Object.keys(a):void 0:[]},Utils.has=function(a,b){return null!==a&&void 0!==a&&Object.prototype.hasOwnProperty.call(a,b)},Utils.isEqual=function(a,b){return eq(a,b,[],[])},Utils.createObjectId=function(){return(new ObjectID).inspect()},Utils.stringify=function(a){return null!=a&&Utils.isArray(a)?JSON.stringify(a,function(a,b){return Utils.isRegex(b)||Utils.isFunction(b)?b.toString():b}):"[]"},Utils.parse=function(str){return null!=str&&Utils.isString(str)?JSON.parse(str,function(key,value){var v;try{v=eval(value)}catch(_error){}if(null!=v&&Utils.isRegex(v))return v;try{v=eval("("+value+")")}catch(_error){}return null!=v&&Utils.isFunction(v)?v:value}):[]},Utils.getTimestamp=function(a){return new ObjectID(a).getTimestamp()},Utils.getTime=function(a){return new ObjectID(a).getTime()},module.exports=Utils});var __indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};define("lib/where",function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o;return d=a("lib/utils"),m=["$gt","$gte","$lt","$lte","$ne","$in","$nin","$and","$nor","$or","$not","$exists","$type","$mod","$regex","$all","$elemMatch","$size"],h=function(a){return __indexOf.call(m,a)>=0},e=function(a,b){var c,d;for(d in b){if(c=b[d],null==a){if("$exists"===d&&c===!1)continue;return!1}if(-1!==d.indexOf(".")){if(g(a,d,c))continue;return!1}if(!o(a,d,c))return!1;if(!i(a,d,c))return!1}return!0},g=function(a,b,c){var d;return d=b.split(".")[0],e(a[/\d/.test(d)?Number(d):d],new function(){this[b.substr(b.indexOf(".")+1)]=c})},o=function(a,b,c){var e;return h(b)?!0:(e=a[b],d.isNumber(c)&&!j(e,c)?!1:d.isString(c)&&!n(e,c)?!1:d.isRegex(c)&&!l(e,c)?!1:d.isArray(c)&&!f(e,c)?!1:d.isObject(c)&&!k(e,c)?!1:!0)},i=function(a,b,c){var f,g,h,j,k,l,m,n,o,p,q;switch(b){case"$gt":if(c>=a)return!1;break;case"$gte":if(c>a)return!1;break;case"$lt":if(a>=c)return!1;break;case"$lte":if(a>c)return!1;break;case"$ne":if(a===c)return!1;break;case"$in":if(d.isArray(a)){for(h=!0,j=0,n=a.length;n>j;j++)g=a[j],h&&function(){var a,b,e;for(b=0,e=c.length;e>b;b++)if(a=c[b],d.isRegex(a)&&a.test(g)||d.isEqual(a,g))return!0;return!1}()&&(h=!1);if(h)return!1}else if(!function(){var b,e,f;for(e=0,f=c.length;f>e;e++)if(b=c[e],d.isRegex(b)&&b.test(a)||d.isEqual(b,a))return!0;return!1}())return!1;break;case"$nin":if(__indexOf.call(c,a)>=0)return!1;break;case"$exists":if(c!==(null!=a))return!1;break;case"$type":if(!d.isType(a,c))return!1;break;case"$mod":if(a%c[0]!==c[1])return!1;break;case"$regex":if(!new RegExp(c).test(a))return!1;break;case"$and":for(k=0,o=c.length;o>k;k++)if(f=c[k],!e(a,f))return!1;break;case"$nor":for(l=0,p=c.length;p>l;l++)if(f=c[l],e(a,f))return!1;break;case"$or":if(!function(){var b,d;for(b=0,d=c.length;d>b;b++)if(f=c[b],e(a,f))return!0;return!1}())return!1;break;case"$not":if(e(a,c))return!1;break;case"$all":if(!d.isArray(a))return!1;for(m=0,q=c.length;q>m;m++)if(f=c[m],!function(){var c,e;for(e=0,c=a.length;c>e;e++)if(g=a[e],d.isArray(f)?i(g,b,f):g===f)return!0}())return!1;break;case"$elemMatch":if(!d.isArray(a))return!1;if(!function(){var b,d;for(d=0,b=a.length;b>d;d++)if(g=a[d],e(g,c))return!0}())return!1;break;case"$size":if(!d.isArray(a))return!1;if(a.length!==c)return!1}return!0},j=function(a,b){return d.isNumber(a)&&b===a?!0:d.isArray(a)&&__indexOf.call(a,b)>=0?!0:!1},n=function(a,b){return d.isString(a)&&b===a?!0:d.isArray(a)&&__indexOf.call(a,b)>=0?!0:!1},l=function(a,b){var c,e,f;if(d.isArray(a)){for(e=0,f=a.length;f>e;e++)if(c=a[e],d.isRegex(c)){if(d.isEqual(c,b))return!0}else if(b.test(c))return!0}else if(d.isRegex(a)){if(d.isEqual(a,b))return!0}else if(b.test(a))return!0;return!1},f=function(a,b){return d.isEqual(a,b)},k=function(a,b){var c,f,g;f=!0;for(g in b)if(c=b[g],h(g)&&(f=!1,!e(a,new function(){this[g]=c})))return!1;return f?d.isEqual(a,b):!0},c.exports=e}),define("localdb",function(a,b,c){var d,e,f,g,h;return g=a("lib/utils"),d=a("lib/collection"),e=a("lib/engine"),h="ldb_",f=function(){function a(a,b){if(null==b&&(b={}),void 0===a)throw new Error("dbName should be specified.");this.name=h+a,this.ls=new e(b.type||1)}return a.prototype.options=function(){return{name:this.name.substr(h.length),type:this.ls.type}},a.prototype.collections=function(){var a,b,c,d;for(d=[],a=b=0,c=this.ls.size();c>=0?c>b:b>c;a=c>=0?++b:--b)0===this.ls.key(a).indexOf(""+this.name+"_")&&d.push(this.ls.key(a).substr((""+this.name+"_").length));return d},a.prototype.collection=function(a){return new d(a,this)},a.prototype.drop=function(a){var b,c,d,e,f;for(a=null!=a?"_"+a:"",d=function(){var c,d,e;for(e=[],b=c=0,d=this.ls.size();d>=0?d>c:c>d;b=d>=0?++c:--c)0===this.ls.key(b).indexOf(this.name+a)&&e.push(this.ls.key(b));return e}.call(this),e=0,f=d.length;f>e;e++)c=d[e],this.ls.removeItem(c);return!0},a}(),f.support=function(){return{localStorage:"undefined"!=typeof localStorage&&null!==localStorage?!0:!1,sessionStorage:"undefined"!=typeof sessionStorage&&null!==sessionStorage?!0:!1,indexedDB:!1}},f.getTimestamp=function(a){return g.getTimestamp(a)},f.getTime=function(a){return g.getTime(a)},c.exports=f});